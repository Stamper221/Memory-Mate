<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MemoryMate</title>
<style>
/* Global CSS variables for themes */
:root {
--bg-color: #f8f8f8;
--card-bg: #ffffff;
--text-color: #222222;
--muted-color: #777777;
--primary-color: #4A90E2;
--danger-color: #E94E77;
--success-color: #50E3C2;
--warning-color: #F5A623;
--nav-bg: #ffffff;
--nav-text: #555555;
--modal-overlay: rgba(0,0,0,0.4);
}
.dark {
--bg-color: #1f1f1f;
--card-bg: #2c2c2c;
--text-color: #f5f5f5;
--muted-color: #aaaaaa;
--primary-color: #5B9BD5;
--danger-color: #D96C79;
--success-color: #6BC1A7;
--warning-color: #D39E47;
--nav-bg: #2c2c2c;
--nav-text: #dddddd;
--modal-overlay: rgba(0,0,0,0.7);
}

* {
box-sizing: border-box;
margin: 0;
padding: 0;
}
html, body {
height: 100%;
}
body {
font-family: sans-serif;
background: var(--bg-color);
color: var(--text-color);
display: flex;
flex-direction: column;
overflow: hidden;
}
/* Main container occupies available space minus bottom nav */
#app {
flex: 1;
overflow-y: auto;
padding-bottom: 60px; /* Space for nav */
}

/* Navigation bar */
nav {
position: fixed;
bottom: 0;
left: 0;
width: 100%;
height: 60px;
background: var(--nav-bg);
border-top: 1px solid rgba(0,0,0,0.1);
display: flex;
justify-content: space-around;
align-items: center;
z-index: 100;
}
nav button {
flex: 1;
background: none;
border: none;
color: var(--nav-text);
font-size: 12px;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
}
nav button.active {
color: var(--primary-color);
}
nav svg {
width: 20px;
height: 20px;
margin-bottom: 4px;
fill: currentColor;
}

/* Section views */
section.view {
display: none;
padding: 16px;
max-width: 600px;
margin: 0 auto;
}
section.view.active {
display: block;
animation: fadeIn 0.2s ease;
}
@keyframes fadeIn {
from { opacity: 0; }
to { opacity: 1; }
}

/* Task cards */
.task-card {
background: var(--card-bg);
border-radius: 8px;
padding: 12px;
margin-bottom: 12px;
box-shadow: 0 2px 4px rgba(0,0,0,0.05);
display: flex;
align-items: flex-start;
gap: 12px;
transition: transform 0.2s;
}
.task-card:hover {
transform: translateY(-2px);
}
.task-icon {
width: 20px;
height: 20px;
flex-shrink: 0;
border-radius: 50%;
margin-top: 4px;
}
.task-content {
flex: 1;
}
.task-title {
font-size: 15px;
font-weight: 600;
}
.task-meta {
font-size: 11px;
color: var(--muted-color);
display: flex;
gap: 8px;
margin-top: 4px;
}
.priority-low { color: var(--success-color); }
.priority-medium { color: var(--warning-color); }
.priority-high { color: var(--danger-color); }
.overdue {
border-left: 4px solid var(--danger-color);
padding-left: 8px;
}

/* Headings */
h1 {
font-size: 24px;
margin-bottom: 16px;
}
h2 {
font-size: 18px;
margin-top: 24px;
margin-bottom: 8px;
}

/* Buttons */
.btn {
padding: 10px 16px;
border: none;
border-radius: 6px;
font-size: 14px;
cursor: pointer;
transition: background 0.2s;
display: inline-flex;
align-items: center;
justify-content: center;
}
.btn-primary {
background: var(--primary-color);
color: #fff;
}
.btn-danger {
background: var(--danger-color);
color: #fff;
}
.btn-secondary {
background: #e0e0e0;
color: #333;
}
.dark .btn-secondary {
background: #444;
color: #fff;
}
.btn:disabled {
opacity: 0.5;
cursor: not-allowed;
}

/* Inputs */
.input-group {
margin-bottom: 12px;
}
.input-group label {
font-size: 12px;
color: var(--muted-color);
display: block;
margin-bottom: 4px;
}
.input-group input,
.input-group select,
.input-group textarea {
width: 100%;
padding: 8px;
border: 1px solid #ccc;
border-radius: 4px;
font-size: 14px;
background: var(--card-bg);
color: var(--text-color);
}
.input-group textarea {
resize: vertical;
min-height: 60px;
}

/* Modal overlay */
.modal-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: var(--modal-overlay);
display: none;
align-items: center;
justify-content: center;
z-index: 200;
}
.modal-overlay.active {
display: flex;
}
.modal {
background: var(--card-bg);
padding: 20px;
border-radius: 8px;
width: 90%;
max-width: 400px;
max-height: 90%;
overflow-y: auto;
box-shadow: 0 2px 8px rgba(0,0,0,0.2);
animation: slideUp 0.3s ease;
}
@keyframes slideUp {
from { transform: translateY(20px); opacity: 0; }
to { transform: translateY(0); opacity: 1; }
}

/* Reminder toast */
#reminder-toast {
position: fixed;
top: 10px;
left: 50%;
transform: translateX(-50%);
background: var(--primary-color);
color: #fff;
padding: 12px 20px;
border-radius: 8px;
display: none;
z-index: 300;
box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
#reminder-toast button {
margin-left: 12px;
background: rgba(255,255,255,0.2);
border: none;
padding: 4px 8px;
border-radius: 4px;
color: #fff;
font-size: 12px;
}

/* Subtasks list */
.subtasks-list {
margin-top: 8px;
}
.subtasks-list .subtask-item {
display: flex;
align-items: center;
margin-bottom: 6px;
font-size: 14px;
}
.subtasks-list .subtask-item input {
margin-right: 8px;
}

/* Category badges */
.category-badge {
display: inline-block;
padding: 2px 6px;
border-radius: 4px;
font-size: 10px;
color: #fff;
margin-left: 4px;
}

/* Settings toggle */
.toggle {
position: relative;
width: 40px;
height: 20px;
background: #ccc;
border-radius: 20px;
cursor: pointer;
}
.toggle:before {
content: "";
position: absolute;
width: 18px;
height: 18px;
border-radius: 50%;
background: #fff;
top: 1px;
left: 1px;
transition: transform 0.2s;
}
.toggle.active {
background: var(--primary-color);
}
.toggle.active:before {
transform: translateX(20px);
}

/* Media queries */
@media(min-width: 600px) {
#app {
padding-bottom: 0;
}
nav {
position: relative;
height: 50px;
}
}
</style>
</head>
<body>
<div id="reminder-toast"></div>
<div id="app">
<!-- Today View -->
<section id="today-view" class="view active">
<h1>Today</h1>
<div id="today-tasks"></div>
</section>
<!-- All Tasks View -->
<section id="all-view" class="view">
<h1>All Tasks</h1>
<button id="goto-category-view" class="btn btn-secondary" style="margin-bottom:12px;">View by Category</button>
<div class="input-group">
<input type="text" id="search-input" placeholder="Search tasks...">
</div>
<div class="input-group">
<select id="filter-category">
<option value="">All Categories</option>
</select>
</div>
<div class="input-group">
<select id="filter-priority">
<option value="">All Priorities</option>
<option value="low">Low</option>
<option value="medium">Medium</option>
<option value="high">High</option>
</select>
</div>
<div id="all-tasks"></div>
</section>
<!-- Category View -->
<section id="category-view" class="view">
<h1 style="display:flex;align-items:center;justify-content:space-between;">
<span>Categories</span>
<button id="back-to-all" class="btn btn-secondary" style="font-size:12px;padding:4px 8px;">Back</button>
</h1>
<div id="category-list"></div>
</section>
<!-- Weekly Review View -->
<section id="weekly-view" class="view">
<h1>Weekly Review</h1>
<div id="weekly-completed"></div>
<div id="weekly-overdue"></div>
<div id="weekly-upcoming"></div>
</section>
<!-- Settings View -->
<section id="settings-view" class="view">
<h1>Settings</h1>
<div class="input-group">
<label>Daily Summary Time</label>
<input type="time" id="summary-time">
</div>
<div class="input-group">
<label>Dark Mode</label>
<div id="theme-toggle" class="toggle"></div>
</div>
<h2>Categories</h2>
<div class="input-group" style="display:flex;gap:8px;">
<input type="text" id="new-category-name" placeholder="New Category">
<button id="add-category-btn" class="btn btn-primary" style="flex-shrink:0;">Add</button>
</div>
<div id="settings-categories"></div>
</section>
<!-- Modals -->
<div id="task-modal" class="modal-overlay">
<div class="modal">
<h2 id="task-modal-title">Add Task</h2>
<div class="input-group">
<label>Title</label>
<input type="text" id="task-title">
</div>
<div class="input-group">
<label>Description</label>
<textarea id="task-description"></textarea>
</div>
<div class="input-group">
<label>Date</label>
<input type="date" id="task-date">
</div>
<div class="input-group">
<label>Time</label>
<input type="time" id="task-time">
</div>
<div class="input-group">
<label>Category</label>
<select id="task-category"></select>
</div>
<div class="input-group">
<label>Priority</label>
<select id="task-priority">
<option value="low">Low</option>
<option value="medium">Medium</option>
<option value="high">High</option>
</select>
</div>
<div class="input-group">
<label>Repeat</label>
<select id="task-repeat">
<option value="none">None</option>
<option value="daily">Daily</option>
<option value="weekly">Weekly</option>
<option value="monthly">Monthly</option>
</select>
</div>
<div class="input-group">
<label>Nag</label>
<select id="task-nag">
<option value="none">Remind Once</option>
<option value="10">Every 10 Minutes</option>
<option value="60">Hourly</option>
<option value="1440">Daily</option>
</select>
</div>
<div style="text-align:right;">
<button id="task-cancel" class="btn btn-secondary">Cancel</button>
<button id="task-save" class="btn btn-primary">Save</button>
</div>
</div>
</div>
<div id="detail-modal" class="modal-overlay">
<div class="modal">
<h2 id="detail-title">Task Details</h2>
<p id="detail-desc"></p>
<p id="detail-info" style="font-size:12px;color:var(--muted-color);margin:8px 0;"></p>
<div>
<h3>Subtasks</h3>
<div id="detail-subtasks" class="subtasks-list"></div>
<div style="display:flex;gap:8px;margin-top:8px;">
<input type="text" id="new-subtask-title" placeholder="New subtask" style="flex:1;">
<button id="add-subtask-btn" class="btn btn-secondary" style="flex-shrink:0;padding:4px 8px;font-size:12px;">Add</button>
</div>
</div>
<div style="margin-top:16px;text-align:right;">
<button id="detail-delete" class="btn btn-danger">Delete</button>
<button id="detail-edit" class="btn btn-secondary">Edit</button>
<button id="detail-complete" class="btn btn-primary">Complete</button>
<button id="detail-close" class="btn btn-secondary">Close</button>
</div>
</div>
</div>
<div id="snooze-modal" class="modal-overlay">
<div class="modal">
<h2>Snooze</h2>
<div class="input-group">
<label>Snooze Minutes</label>
<input type="number" id="snooze-minutes" min="1" value="10">
</div>
<div style="text-align:right;">
<button id="snooze-cancel" class="btn btn-secondary">Cancel</button>
<button id="snooze-save" class="btn btn-primary">Snooze</button>
</div>
</div>
</div>
<div id="summary-modal" class="modal-overlay">
<div class="modal">
<h2>End of Day Summary</h2>
<div id="summary-content"></div>
<div style="text-align:right;margin-top:16px;">
<button id="summary-close" class="btn btn-primary">Close</button>
</div>
</div>
</div>
</div>
<!-- Bottom Nav -->
<nav>
<button data-view="today-view" class="active">
<svg viewBox="0 0 24 24"><path d="M3 6h18v2H3V6zm0 4h18v2H3v-2zm0 4h18v2H3v-2zm0 4h18v2H3v-2z"/></svg>
<span>Today</span>
</button>
<button data-view="all-view">
<svg viewBox="0 0 24 24"><path d="M3 5h18v2H3V5zm0 4h18v2H3V9zm0 4h18v2H3v-2zm0 4h18v2H3v-2z"/></svg>
<span>All</span>
</button>
<button id="add-task-nav">
<svg viewBox="0 0 24 24"><path d="M12 5v14m7-7H5"/></svg>
<span>Add</span>
</button>
<button data-view="weekly-view">
<svg viewBox="0 0 24 24"><path d="M3 4h18v2H3V4zm0 14h18v2H3v-2zm0-7h18v2H3v-2zm0-3h18v2H3V8zm0 6h18v2H3v-2zm0-6h18v2H3V8z"/></svg>
<span>Review</span>
</button>
<button data-view="settings-view">
<svg viewBox="0 0 24 24"><path d="M12 1.5l3 4.5h5.5l-1.38 6.25L22.5 16 20 23l-6-3-6 3L1.5 16l3.38-3.75L3.5 6H9L12 1.5z"/></svg>
<span>Settings</span>
</button>
</nav>
<script>
// MemoryMate JavaScript for managing tasks, categories, settings, reminders
(() => {
/* ---------- Data ---------- */
let tasks = [];
let categories = [];
let settings = { summaryTime: '20:00', theme: 'light' };
let editingTaskId = null;
let reminderTimer;
const TASKS_KEY = 'mm_tasks';
const CATS_KEY = 'mm_categories';
const SETTINGS_KEY = 'mm_settings';
const SUMMARY_SHOWN_KEY = 'mm_summary_shown';

/* ---------- Utility Functions ---------- */
function uuid() { return '_' + Math.random().toString(36).substr(2,9); }
function saveTasks() { localStorage.setItem(TASKS_KEY, JSON.stringify(tasks)); }
function loadTasks() { tasks = JSON.parse(localStorage.getItem(TASKS_KEY) || '[]'); }
function saveCategories() { localStorage.setItem(CATS_KEY, JSON.stringify(categories)); }
function loadCategories() {
categories = JSON.parse(localStorage.getItem(CATS_KEY) || '[]');
if (categories.length === 0) {
// Default categories
categories = [
{ id: 'teach', name: 'Teaching / School', color: '#5B9BD5' },
{ id: 'work', name: 'Work / Business', color: '#D39E47' },
{ id: 'home', name: 'Home & Family', color: '#D96C79' },
{ id: 'bills', name: 'Bills & Finance', color: '#6BC1A7' },
{ id: 'personal', name: 'Personal', color: '#A17CC1' },
{ id: 'health', name: 'Health / Self-Care', color: '#4A90E2' },
{ id: 'later', name: 'For Later', color: '#7F8DAA' }
];
saveCategories();
}
}
function saveSettings() { localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings)); }
function loadSettings() {
const s = JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}');
Object.assign(settings, s);
}
function formatDate(dateStr) {
if (!dateStr) return '';
const d = new Date(dateStr);
return d.toLocaleDateString(undefined, { month: 'short', day: 'numeric' });
}
function formatTime(timeStr) {
if (!timeStr) return '';
const [h, m] = timeStr.split(':');
const date = new Date();
date.setHours(h, m);
return date.toLocaleTimeString(undefined, { hour: 'numeric', minute: '2-digit' });
}
function combineDateTime(date, time) {
if (!date) return null;
const dtStr = date + (time ? 'T' + time : 'T00:00');
return new Date(dtStr);
}
function isOverdue(task) {
if (task.completed) return false;
const dt = combineDateTime(task.date, task.time);
return dt && dt.getTime() < Date.now();
}
function getNextOccurrence(task) {
const dt = combineDateTime(task.date, task.time);
if (!dt) return null;
let next = new Date(dt);
switch (task.repeat) {
case 'daily': next.setDate(next.getDate() + 1); break;
case 'weekly': next.setDate(next.getDate() + 7); break;
case 'monthly': next.setMonth(next.getMonth() + 1); break;
}
return next;
}
function nagInterval(task) {
const map = { '10': 10, '60': 60, '1440': 1440 };
return map[task.nag] || 0;
}
function addMinutes(date, mins) {
const newDate = new Date(date);
newDate.setMinutes(newDate.getMinutes() + mins);
return newDate;
}

/* ---------- Rendering Functions ---------- */
function renderCategoriesOptions(select) {
select.innerHTML = '';
categories.forEach(cat => {
const opt = document.createElement('option');
opt.value = cat.id;
opt.textContent = cat.name;
select.appendChild(opt);
});
}
function createTaskCard(task) {
const card = document.createElement('div');
card.className = 'task-card' + (isOverdue(task) ? ' overdue' : '');
const color = (categories.find(c => c.id === task.category) || {}).color || '#ccc';
const icon = document.createElement('div');
icon.className = 'task-icon';
icon.style.background = color;
card.appendChild(icon);
const content = document.createElement('div');
content.className = 'task-content';
const title = document.createElement('div');
title.className = 'task-title';
title.textContent = task.title;
content.appendChild(title);
const meta = document.createElement('div');
meta.className = 'task-meta';
const dateStr = formatDate(task.date);
const timeStr = formatTime(task.time);
const pieces = [];
if (dateStr) pieces.push(dateStr);
if (timeStr) pieces.push(timeStr);
if (task.repeat && task.repeat !== 'none') pieces.push(task.repeat.charAt(0).toUpperCase()+task.repeat.slice(1));
if (task.priority) pieces.push('<span class="priority-'+task.priority+'">'+task.priority.charAt(0).toUpperCase()+task.priority.slice(1)+'</span>');
meta.innerHTML = pieces.join(' â€¢ ');
content.appendChild(meta);
card.appendChild(content);
card.addEventListener('click', () => openDetailModal(task.id));
return card;
}
function renderToday() {
const container = document.getElementById('today-tasks');
container.innerHTML = '';
const today = new Date().toISOString().split('T')[0];
const todays = tasks.filter(t => t.date === today);
if (todays.length === 0) {
container.textContent = 'No tasks for today.';
} else {
// group by time-of-day
const groups = { morning: [], afternoon: [], evening: [] };
todays.forEach(t => {
if (!t.time) groups.morning.push(t);
else {
const hour = parseInt(t.time.split(':')[0]);
if (hour < 12) groups.morning.push(t);
else if (hour < 17) groups.afternoon.push(t);
else groups.evening.push(t);
}
});
['morning','afternoon','evening'].forEach(part => {
if (groups[part].length > 0) {
const h = document.createElement('h2');
h.textContent = part.charAt(0).toUpperCase()+part.slice(1);
container.appendChild(h);
groups[part]
.sort((a,b) => (a.time || '') > (b.time || '') ? 1 : -1)
.forEach(task => container.appendChild(createTaskCard(task)));
}
});
}
}
function renderAll() {
const container = document.getElementById('all-tasks');
container.innerHTML = '';
let filtered = tasks.slice();
const query = document.getElementById('search-input').value.toLowerCase();
const catFilter = document.getElementById('filter-category').value;
const priFilter = document.getElementById('filter-priority').value;
if (query) filtered = filtered.filter(t => t.title.toLowerCase().includes(query) || t.description.toLowerCase().includes(query));
if (catFilter) filtered = filtered.filter(t => t.category === catFilter);
if (priFilter) filtered = filtered.filter(t => t.priority === priFilter);
filtered.sort((a,b) => {
const aDT = combineDateTime(a.date, a.time);
const bDT = combineDateTime(b.date, b.time);
return (aDT || 0) - (bDT || 0);
});
if (filtered.length === 0) {
container.textContent = 'No tasks found.';
} else {
filtered.forEach(task => container.appendChild(createTaskCard(task)));
}
}
function renderCategoryView() {
const container = document.getElementById('category-list');
container.innerHTML = '';
categories.forEach(cat => {
const section = document.createElement('div');
const h3 = document.createElement('h2');
h3.textContent = cat.name;
section.appendChild(h3);
const catTasks = tasks.filter(t => t.category === cat.id);
if (catTasks.length === 0) {
const p = document.createElement('p');
p.textContent = 'No tasks in this category.';
section.appendChild(p);
} else {
catTasks.sort((a,b) => {
const aDT = combineDateTime(a.date,a.time);
const bDT = combineDateTime(b.date,b.time);
return (aDT || 0)-(bDT || 0);
});
catTasks.forEach(task => section.appendChild(createTaskCard(task)));
}
container.appendChild(section);
});
}
function renderWeeklyReview() {
const completedContainer = document.getElementById('weekly-completed');
const overdueContainer = document.getElementById('weekly-overdue');
const upcomingContainer = document.getElementById('weekly-upcoming');
completedContainer.innerHTML = '<h2>Completed (Last 7 days)</h2>';
overdueContainer.innerHTML = '<h2>Overdue</h2>';
upcomingContainer.innerHTML = '<h2>Upcoming (Next 7 days)</h2>';
const now = new Date();
const weekAgo = new Date(now);
weekAgo.setDate(now.getDate() - 7);
const nextWeek = new Date(now);
nextWeek.setDate(now.getDate() + 7);
tasks.forEach(task => {
const dt = combineDateTime(task.date, task.time);
if (task.completed) {
const completedAt = new Date(task.completedAt);
if (completedAt >= weekAgo && completedAt <= now) {
completedContainer.appendChild(createTaskCard(task));
}
} else {
if (dt) {
if (dt < now) overdueContainer.appendChild(createTaskCard(task));
else if (dt <= nextWeek) upcomingContainer.appendChild(createTaskCard(task));
} else {
// tasks without date/time considered upcoming
upcomingContainer.appendChild(createTaskCard(task));
}
}
});
// Actions for overdue tasks
if (overdueContainer.children.length > 1) {
const moveBtn = document.createElement('button');
moveBtn.className = 'btn btn-primary';
moveBtn.textContent = 'Move overdue to tomorrow';
moveBtn.onclick = () => {
const tomorrow = new Date();
tomorrow.setDate(tomorrow.getDate() + 1);
const dateStr = tomorrow.toISOString().split('T')[0];
tasks.forEach(task => {
const dt = combineDateTime(task.date, task.time);
if (!task.completed && dt && dt < now) {
task.date = dateStr;
task.nextReminder = combineDateTime(dateStr, task.time).getTime();
}
});
saveTasks();
renderWeeklyReview(); renderToday(); renderAll(); renderCategoryView();
};
overdueContainer.appendChild(moveBtn);
}
}
function renderSettings() {
// summary time
document.getElementById('summary-time').value = settings.summaryTime;
// theme toggle
const toggle = document.getElementById('theme-toggle');
toggle.classList.toggle('active', settings.theme === 'dark');
// categories list
const catContainer = document.getElementById('settings-categories');
catContainer.innerHTML = '';
categories.forEach(cat => {
const div = document.createElement('div');
div.style.display = 'flex';
div.style.alignItems = 'center';
div.style.marginBottom = '8px';
const badge = document.createElement('span');
badge.textContent = cat.name;
badge.className = 'category-badge';
badge.style.background = cat.color;
badge.style.color = '#fff';
badge.style.marginRight = '8px';
div.appendChild(badge);
if (!['teach','work','home','bills','personal','health','later'].includes(cat.id)) {
const delBtn = document.createElement('button');
delBtn.textContent = 'Delete';
delBtn.className = 'btn btn-danger';
delBtn.style.fontSize = '10px';
delBtn.style.padding = '4px 6px';
delBtn.onclick = () => {
categories = categories.filter(c => c.id !== cat.id);
// update tasks referencing this category
tasks.forEach(t => {
if (t.category === cat.id) t.category = '';
});
saveCategories(); saveTasks();
renderSettings(); renderAll(); renderToday(); renderCategoryView();
};
div.appendChild(delBtn);
}
catContainer.appendChild(div);
});
}

/* ---------- Modals ---------- */
function openTaskModal(id) {
editingTaskId = id;
document.getElementById('task-modal-title').textContent = id ? 'Edit Task' : 'Add Task';
// Populate fields
const task = tasks.find(t => t.id === id);
document.getElementById('task-title').value = task ? task.title : '';
document.getElementById('task-description').value = task ? task.description : '';
document.getElementById('task-date').value = task ? task.date : '';
document.getElementById('task-time').value = task ? task.time : '';
renderCategoriesOptions(document.getElementById('task-category'));
document.getElementById('task-category').value = task ? task.category : categories[0]?.id || '';
document.getElementById('task-priority').value = task ? task.priority : 'low';
document.getElementById('task-repeat').value = task ? task.repeat : 'none';
document.getElementById('task-nag').value = task ? task.nag : 'none';
document.getElementById('task-modal').classList.add('active');
}
function closeTaskModal() {
editingTaskId = null;
document.getElementById('task-modal').classList.remove('active');
}
function openDetailModal(id) {
const task = tasks.find(t => t.id === id);
if (!task) return;
document.getElementById('detail-title').textContent = task.title;
document.getElementById('detail-desc').textContent = task.description || 'No description';
const infoParts = [];
if (task.date) infoParts.push(formatDate(task.date));
if (task.time) infoParts.push(formatTime(task.time));
const cat = categories.find(c => c.id === task.category);
if (cat) infoParts.push(cat.name);
if (task.priority) infoParts.push('Priority: '+task.priority);
if (task.repeat && task.repeat !== 'none') infoParts.push('Repeats: '+task.repeat);
if (task.nag && task.nag !== 'none') {
const map = { '10':'Every 10m','60':'Hourly','1440':'Daily' };
infoParts.push('Nag: '+map[task.nag]);
}
document.getElementById('detail-info').innerHTML = infoParts.join(' &bullet; ');
// Subtasks
const subList = document.getElementById('detail-subtasks');
subList.innerHTML = '';
(task.subtasks || []).forEach(st => {
const item = document.createElement('div');
item.className = 'subtask-item';
const chk = document.createElement('input');
chk.type = 'checkbox';
chk.checked = st.completed;
chk.onchange = () => {
st.completed = chk.checked;
saveTasks();
};
item.appendChild(chk);
const span = document.createElement('span');
span.textContent = st.title;
item.appendChild(span);
subList.appendChild(item);
});
document.getElementById('new-subtask-title').value = '';
// Buttons
document.getElementById('detail-edit').onclick = () => {
closeDetailModal();
openTaskModal(id);
};
document.getElementById('detail-delete').onclick = () => {
if (confirm('Delete this task?')) {
deleteTask(id);
closeDetailModal();
}
};
document.getElementById('detail-complete').onclick = () => {
completeTask(id);
closeDetailModal();
};
document.getElementById('add-subtask-btn').onclick = () => {
const title = document.getElementById('new-subtask-title').value.trim();
if (!title) return;
task.subtasks = task.subtasks || [];
task.subtasks.push({ id: uuid(), title, completed: false });
saveTasks();
openDetailModal(id);
};
document.getElementById('detail-close').onclick = closeDetailModal;
document.getElementById('detail-modal').classList.add('active');
}
function closeDetailModal() {
document.getElementById('detail-modal').classList.remove('active');
}
function openSnoozeModal(taskId) {
document.getElementById('snooze-modal').classList.add('active');
document.getElementById('snooze-save').onclick = () => {
const mins = parseInt(document.getElementById('snooze-minutes').value);
const task = tasks.find(t => t.id === taskId);
if (task && mins > 0) {
const next = addMinutes(new Date(), mins);
task.nextReminder = next.getTime();
saveTasks();
}
document.getElementById('snooze-modal').classList.remove('active');
};
document.getElementById('snooze-cancel').onclick = () => {
document.getElementById('snooze-modal').classList.remove('active');
};
}
function openSummaryModal() {
const cont = document.getElementById('summary-content');
cont.innerHTML = '';
const today = new Date().toISOString().split('T')[0];
const done = tasks.filter(t => t.completed && t.completedAt && new Date(t.completedAt).toISOString().split('T')[0] === today);
const notDone = tasks.filter(t => !t.completed && t.date === today);
if (done.length > 0) {
const h = document.createElement('h3');
h.textContent = 'Completed Today';
cont.appendChild(h);
done.forEach(task => cont.appendChild(createTaskCard(task)));
}
if (notDone.length > 0) {
const h2 = document.createElement('h3');
h2.textContent = 'Incomplete Tasks';
cont.appendChild(h2);
notDone.forEach(task => cont.appendChild(createTaskCard(task)));
const moveBtn = document.createElement('button');
moveBtn.className = 'btn btn-primary';
moveBtn.textContent = 'Move incomplete to tomorrow';
moveBtn.onclick = () => {
const tomorrow = new Date();
tomorrow.setDate(tomorrow.getDate() + 1);
const dateStr = tomorrow.toISOString().split('T')[0];
notDone.forEach(task => {
task.date = dateStr;
task.nextReminder = combineDateTime(task.date, task.time).getTime();
});
saveTasks();
closeSummaryModal();
renderToday(); renderAll(); renderWeeklyReview(); renderCategoryView();
};
cont.appendChild(moveBtn);
} else if (done.length === 0) {
cont.textContent = 'No tasks today.';
}
document.getElementById('summary-modal').classList.add('active');
document.getElementById('summary-close').onclick = () => {
document.getElementById('summary-modal').classList.remove('active');
};
}

/* ---------- Task Operations ---------- */
function saveTaskFromModal() {
const title = document.getElementById('task-title').value.trim();
if (!title) { alert('Please enter a title'); return; }
const desc = document.getElementById('task-description').value.trim();
const date = document.getElementById('task-date').value;
const time = document.getElementById('task-time').value;
const category = document.getElementById('task-category').value;
const priority = document.getElementById('task-priority').value;
const repeat = document.getElementById('task-repeat').value;
const nag = document.getElementById('task-nag').value;
const newTask = {
id: editingTaskId || uuid(),
title,
description: desc,
date,
time,
category,
priority,
repeat,
nag,
completed: false,
completedAt: null,
nextReminder: null,
subtasks: editingTaskId ? (tasks.find(t => t.id === editingTaskId).subtasks || []) : [],
createdAt: new Date().toISOString()
};
const dueDT = combineDateTime(date, time);
if (dueDT) newTask.nextReminder = dueDT.getTime();
if (editingTaskId) {
// Update existing
tasks = tasks.map(t => t.id === editingTaskId ? newTask : t);
} else {
tasks.push(newTask);
}
saveTasks();
closeTaskModal();
renderAll(); renderToday(); renderCategoryView(); renderWeeklyReview();
}
function deleteTask(id) {
tasks = tasks.filter(t => t.id !== id);
saveTasks();
renderAll(); renderToday(); renderCategoryView(); renderWeeklyReview();
}
function completeTask(id) {
const task = tasks.find(t => t.id === id);
if (!task) return;
task.completed = true;
task.completedAt = new Date().toISOString();
task.nextReminder = null;
saveTasks();
// If recurring, generate new
if (task.repeat && task.repeat !== 'none') {
const next = getNextOccurrence(task);
if (next) {
const newId = uuid();
const newTask = Object.assign({}, task, {
id: newId,
date: next.toISOString().split('T')[0],
time: task.time,
completed: false,
completedAt: null,
nextReminder: next.getTime(),
subtasks: task.subtasks ? task.subtasks.map(st => ({ id: uuid(), title: st.title, completed: false })) : []
});
tasks.push(newTask);
}
}
saveTasks();
renderAll(); renderToday(); renderCategoryView(); renderWeeklyReview();
}

/* ---------- Reminder & Summary Scheduler ---------- */
function startReminderCheck() {
if (reminderTimer) clearInterval(reminderTimer);
reminderTimer = setInterval(() => {
const now = Date.now();
// Check reminders
tasks.forEach(task => {
if (task.nextReminder && !task.completed && task.nextReminder <= now) {
showReminder(task);
}
});
// Check summary time
checkDailySummary();
}, 60000); // check every minute
}
function showReminder(task) {
// Avoid repeated reminders: reset nextReminder
if (task.nag === 'none') {
task.nextReminder = null;
} else {
const interval = nagInterval(task);
if (interval > 0) {
const next = addMinutes(new Date(), interval);
task.nextReminder = next.getTime();
}
}
saveTasks();
const toast = document.getElementById('reminder-toast');
toast.innerHTML = `${task.title} due! <button id="rem-done">Done</button> <button id="rem-snooze">Snooze</button>`;
toast.style.display = 'block';
// Optionally play sound
try {
const beep = new Audio('data:audio/wav;base64,UklGRtQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YcQAAAB//3///wD/AAD///8AAACAgICAgP8AAID/AgD//wD/8AAAP//AAD//wAAgP8AAP//AAD//wAA////AAD//wAA');
beep.play();
} catch(e) {}
toast.querySelector('#rem-done').onclick = () => {
completeTask(task.id);
toast.style.display = 'none';
};
toast.querySelector('#rem-snooze').onclick = () => {
openSnoozeModal(task.id);
toast.style.display = 'none';
};
}
function checkDailySummary() {
const todayStr = new Date().toDateString();
const lastShown = localStorage.getItem(SUMMARY_SHOWN_KEY);
if (lastShown === todayStr) return; // already shown today
const timeParts = settings.summaryTime.split(':');
const summaryDate = new Date();
summaryDate.setHours(parseInt(timeParts[0]), parseInt(timeParts[1]), 0, 0);
if (Date.now() >= summaryDate.getTime()) {
// Show summary
openSummaryModal();
localStorage.setItem(SUMMARY_SHOWN_KEY, todayStr);
}
}

/* ---------- Event Listeners ---------- */
function addEventListeners() {
// Navigation buttons
document.querySelectorAll('nav button[data-view]').forEach(btn => {
btn.addEventListener('click', () => {
const view = btn.getAttribute('data-view');
setActiveView(view);
document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
btn.classList.add('active');
});
});
// Add task nav button
document.getElementById('add-task-nav').addEventListener('click', () => {
openTaskModal(null);
});
// Modal save/cancel
document.getElementById('task-cancel').addEventListener('click', closeTaskModal);
document.getElementById('task-save').addEventListener('click', saveTaskFromModal);
// Search & filter
document.getElementById('search-input').addEventListener('input', renderAll);
document.getElementById('filter-category').addEventListener('change', renderAll);
document.getElementById('filter-priority').addEventListener('change', renderAll);
// Settings change
document.getElementById('summary-time').addEventListener('change', (e) => {
settings.summaryTime = e.target.value;
saveSettings();
});
document.getElementById('theme-toggle').addEventListener('click', () => {
const theme = settings.theme === 'light' ? 'dark' : 'light';
settings.theme = theme;
document.body.classList.toggle('dark', theme === 'dark');
saveSettings();
});
document.getElementById('add-category-btn').addEventListener('click', () => {
const name = document.getElementById('new-category-name').value.trim();
if (!name) return;
const id = uuid();
// Random color generation
const color = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
categories.push({ id, name, color });
document.getElementById('new-category-name').value = '';
saveCategories();
renderSettings(); renderAll(); renderToday(); renderCategoryView();
});

// Link to category view from All tasks
const catBtn = document.getElementById('goto-category-view');
if (catBtn) {
catBtn.addEventListener('click', () => {
setActiveView('category-view');
});
}
// Back button from Category view
const backBtn = document.getElementById('back-to-all');
if (backBtn) {
backBtn.addEventListener('click', () => {
// simulate click on All nav to set active state
const navAll = document.querySelector('nav button[data-view="all-view"]');
if (navAll) {
navAll.click();
} else {
setActiveView('all-view');
}
});
}
}
function setActiveView(viewId) {
document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
document.getElementById(viewId).classList.add('active');
// Render specific view if needed
if (viewId === 'today-view') renderToday();
if (viewId === 'all-view') {
// populate filter categories
const select = document.getElementById('filter-category');
select.innerHTML = '<option value="">All Categories</option>';
categories.forEach(cat => {
const opt = document.createElement('option');
opt.value = cat.id;
opt.textContent = cat.name;
select.appendChild(opt);
});
renderAll();
}
if (viewId === 'category-view') renderCategoryView();
if (viewId === 'weekly-view') renderWeeklyReview();
if (viewId === 'settings-view') renderSettings();
}

/* ---------- Initialization ---------- */
function init() {
loadTasks();
loadCategories();
loadSettings();
// Apply theme
document.body.classList.toggle('dark', settings.theme === 'dark');
// Render initial views
renderToday();
renderAll();
renderCategoryView();
renderWeeklyReview();
renderSettings();
// Start reminder scheduler
startReminderCheck();
// Setup events
addEventListeners();
// Prepare category select for add/edit
renderCategoriesOptions(document.getElementById('task-category'));
}
// Wait for DOM ready
document.addEventListener('DOMContentLoaded', init);
})();
</script>
</body>
</html>